<!DOCTYPE html>
<html>
   <head>
       <link rel="stylesheet" type="text/css" href="style.css">
       <meta name="viewport" content="width=device-width, initial-scale=1">
       <script src="https://d3js.org/d3.v4.min.js"></script>
       
       
        <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.11/jquery-ui.min.js"></script>
        
        <script src="d3.slider.js"></script>
        

   </head>
    <body>
        <div id="intro" class="container">
            <img src="zika.png" alt="ZIKA" id="zikaHeader">
        </div>
        <div id="selectors1">
           <p>8/18 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8/25</p>
            <div id="slider"></div>
        </div>
        <div id="selectors2">
            <p>Choose a Country</p>
            <!--<input type="text" id="tbCountries" />-->
            <div id="tbCountries"></div> 
        </div>
        <br>
        
        <div id="chart" class="container"></div>
        
        <div id="footer">
            <p id="designed">Designed by Sevika Singh and Alberto Cairo</p>
            <p id="powered">Powered by: </p>
            <img src="trendslogo.png" alt="Google Trends" id="trendsLogo">
        </div>
        
        <script type="text/javascript">
            
            var optionsData;
            var dropDown;
            var dateSelected;
            
            //var valMap = ["8/15", "8/28"];
            
            
            //$( "#slider" ).on( "slidechange", function( event, ui ) {} );
            
            //var color = d3.scaleOrdinal(d3.schemeCategory20);
            
            var color = d3.scaleThreshold()
                .domain([true, false])
                .range(["#FBBC05", "#4285F4"]);
            
            var margin = {top: 30, right: 45, bottom: 30, left: 45}
                      , width = parseInt(d3.select('#chart').style('width'), 10)
                      , width = width - margin.left - margin.right
                      , height = width*1.4 // placeholder
                      , barHeight = 20
                      , spacing = 3
                      , percent = d3.format('%');
            /*
            var leftScale = d3.scaleLinear()
                .domain([0.0, 100.0])
                .range([height - margin.top, margin.bottom]);

            var rightScale = d3.scaleLinear()
                .domain([0.0, 100.0])
                .range([height - margin.top, margin.bottom]);
            */
            
            // create the chart
            var svg = d3.select('#chart').append('svg')
                .style('width', (width + margin.left + margin.right) + 'px')
                .style('height', (height + margin.top + margin.bottom) + 'px')
                .attr('class', 'chartclass')
                .append('g')
                .attr('transform', 'translate(' + [margin.left, margin.top] + ')');
            
            
            d3.csv('dataFormatted2.csv', function(d) {
                data = d;
                
                
                var data_max = d3.extent(data, function(d) {return d['raw_incidence_rate']; });
                
                var leftScale = d3.scaleLinear()
                    .domain([0.0, 100.0])
                    .range([height - margin.top, margin.bottom]);

                var rightScale = d3.scaleLinear()
                    .domain([0.0, 10000])
                    .range([height - margin.top, margin.bottom]);
                
                //data.sort(function (a, b) {
				//	return b.search_interest-a.search_interest;
				//});

                var lines = svg.selectAll("line")
                    .data(data);

                lines.enter()
                    .append("line")
                    .attr('class', 'lineclass')
                    .attr("x1", margin.left)
                    .attr("x2", width - margin.right)
                    .attr("y1", function(d) {
                        return leftScale(parseFloat(d['search_interest']));
                    })
                    .attr("y2", function(d) {
                        //console.log(d.search_interest-d.raw_incidence_rate < 0 );
                        return rightScale(parseFloat(d['raw_incidence_rate']));
                    })
                    .attr("stroke", function(d) {
                    //.attr("class", function(d){return d.search_interest-d.raw_incidence_rate < 0 ? "negative" : "positive";})
                        return color(d.search_interest-d.raw_incidence_rate < 0);
                    })
                    .attr("stroke-width", 1.5);
                
                svg.selectAll("line").filter(function(d) {
                                return "8/18" != d.Date;})
                                    .attr("display", "inline");
                svg.selectAll("line").filter(function(d) {
                                return "8/18" == d.Date;})
                                    .attr("display", "none");
                
                /*
                var rightLabels = svg.selectAll(".labels")
                    .data(data);

                rightLabels.enter()
                    .append("text")
                    .attr("class","labels1 displaylabels")
                    .attr("x", 10)
                    .attr("y", function(d) {
                        return rightScale(parseFloat(d['search_interest'])) + 3;
                    })
                    .attr("text-anchor", "middle")
                    .text(function (d) {
                        return (d['Country']);
                    });
                rightLabels.enter()
                    .append("text")
                    .attr("class","labels2 displaylabels")
                    .attr("x", 10)
                    .attr("y", function(d) {
                        return rightScale(parseFloat(d['search_interest'])) + 10;
                    })
                    .attr("text-anchor", "middle")
                    .text(function (d) {
                        return ("Interest " + d['search_interest']);
                    });
                rightLabels.enter()
                    .append("text")
                    .attr("class","labels3 displaylabels")
                    .attr("x", 10)
                    .attr("y", function(d) {
                        return rightScale(parseFloat(d['search_interest'])) + 17;
                    })
                    .attr("text-anchor", "middle")
                    .text(function (d) {
                        return ("Rate " + d['raw_incidence_rate']);
                    });
                    */
                
                /*
                .call(wrap, 100);
                
                
                function wrap(text, width) {
                      text.each(function() {
                        var text = d3.select(this),
                            words = text.text().split(/\s+/).reverse(),
                            word,
                            line = [],
                            lineNumber = 0,
                            lineHeight = 1.1, // ems
                            y = text.attr("y"),
                            dy = (d['search_interest']) + 17,
                            tspan = text.text(null).append("tspan").attr("x", 0).attr("y", y).attr("dy", dy + "em");
                        while (word = words.pop()) {
                          line.push(word);
                          tspan.text(line.join(" "));
                          if (tspan.node().getComputedTextLength() > width) {
                            line.pop();
                            tspan.text(line.join(" "));
                            line = [word];
                            tspan = text.append("tspan").attr("x", 0).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
                          }
                        }
                      });
                    }
                    */

                /*
                var leftLabels = svg.selectAll(".left-labels")
                    .data(data);

                leftLabels.enter()
                    .append("text")
                    .attr("class","left-labels")
                    .attr("x", margin.left - 65)
                    .attr("y", function(d) {
                        return leftScale(parseFloat(d['search_interest'])) + 4;
                    })
                    .text(function (d) {
                        return d['country'];
                    })
                    .style("text-anchor","begin");
                    */
                
                
                //(function (d) {return (d['raw_incidence_rate']);})
                
                //console.log(data_max);
                
                var y_domain2 = d3.extent(data, function(d) {return d['raw_incidence_rate']; });

                var yScale = d3.scaleLinear()
                    .domain([0,100])
                    .range([height -  margin.top, margin.bottom], 0);  
                
                var yScale2 = d3.scaleLinear()
                    .domain([data_max[0], 10000])
                //data_max[1]
                    .range([height -  margin.top, margin.bottom], 0); 
                
                var axisScale = d3.scaleLinear()
                         .domain([0,100])
                         .range([0,100]);

                var yAxisLeft = d3.axisLeft()
                    .ticks(2)
                    .scale(yScale);
                
                var yAxisRight = d3.axisRight()
                    .ticks(2)
                    .scale(yScale2);
                    
                
                svg.append("svg:g")
                    .attr("transform", "translate(" + (margin.left - 10) +  ",0)")
                    .attr("class", "y axis whiteText")
                    .call(yAxisLeft);
                
                svg.append("svg:g")
                    .attr("transform", "translate(" + (width-margin.left + 10) + " ,0)")	
                    .attr("class", "y axis whiteText")
                    .call(yAxisRight);
                
                svg.append("text")
                    .attr("class", "whiteText")
                    .style("font-size","1.1em")
                    .attr("text-anchor", "middle")
                    .attr("transform", "translate("+ (margin.left) +","+(10)+")")
                    .text("Search Interest");
                
                svg.append("text")
                    .attr("class", "whiteText")
                    .style("font-size","1.1em")
                    .attr("text-anchor", "middle")
                    .attr("transform", "translate("+ (width -margin.left) +","+(10)+")")
                    .text("Indexed Incidence Rate");
                
                console.log(y_domain2);
                
                optionsData = (data.map(function(d) {return d.Country;}));
                optionsData.sort();
                
                Array.prototype.unique = function(a){
                        return function(){ return this.filter(a) }
                    }(function(a,b,c){ return c.indexOf(a,b+1) < 0 });
                
                
                optionsData = optionsData.unique();
                
                data2 = data.sort(function (a, b) {
					return d3.ascending(a.Country, b.Country);
				});
                
                //console.log(data2);
                
                dropDown = d3.select("#tbCountries").append("select")
                    .attr("name", "country-list");
                
                var options = dropDown.selectAll("option")
                           .data(optionsData)
                         .enter()
                           .append("option")
                            .attr("value", function(d) {return d})
                            .text(function(d) {return d;});

                //options.text(function (d) { return d.Country; })
                       //.attr("value", function (d) { return d.Country; });
                
                d3.selection.prototype.moveToFront = function() {
                  return this.each(function(){
                    this.parentNode.appendChild(this);
                  });
                };
                
                dropDown.on("change", function() {
                      var selected = this.value;
                      displayOthers = this.checked ? "inline" : "none";
                      display = this.checked ? "none" : "inline";

                    

                     // doubleChart.selectAll(".circle")
                    svg.selectAll("line").filter(function(d) {
                        //console.log(d.Country);
                        return selected != d.Country;})
                          //.attr("display", displayOthers);
                          //.attr("fill", "#884dff")
                            //.style("stroke", "#884dff")
                            //.attr("stroke", "green")
                            .style("stroke-width", 1.5)
                            .style("opacity", .5 );

                      //doubleChart.selectAll(".circle")
                    svg.selectAll("line").filter(function(d) {return selected == d.Country;})
                          //.attr("display", display);
                            //.attr("fill", "white");
                            //.style("stroke", "red")
                            //.attr("stroke", "red")
                            .moveToFront()
                            .style("opacity", 1)
                            .style("stroke-width", 6); 
                    
                    svg.selectAll("rightLabels").filter(function(d) {return selected != d.Country;})
                            .attr("class", "displaylabels");
                    
                    svg.selectAll("rightLabels").filter(function(d) {return selected == d.Country;})
                            .attr("class", "showdisplaylabels")
                    .attr("fill", "green");
                    //console.log("changed");
                    
                    
                  });
                
                var steps = [
                    "8/18",
                    "8/25"
                ];

                $(function() {
                    $("#slider").slider({
                        value: 1,
                        min: 0,
                        max: 1,
                        step: 1,
                        slide: function(event, ui) {
                            $("#amount").val(steps[ui.value]);
                            dateSelected= steps[ui.value];
                            console.log(dateSelected);
                            
                            
                            var selected = dateSelected;
                            
                            svg.selectAll("line").filter(function(d) {
                                return selected != d.Date;})
                                    .transition()
                                    //.style("stroke", "red");
                                    .attr("display", "none");
                            svg.selectAll("line").filter(function(d) {
                                return selected == d.Date;})
                                    .transition()
                                    //.style("stroke", "green");
                                    .attr("display", "inline");
                            
                            
                            
                        }
                    });
                    $("#amount").val(steps[$("#slider").slider("value")]);
                });
                
                
            }); 
            
            
            
        //Resize
        
          /*  
        d3.select(window).on('resize', resize); 

        function resize() {
            document.getElementById('chart').innerHTML = "";
            
            var margin = {top: 10, right: 35, bottom: 10, left: 35}
                      , width = parseInt(d3.select('#chart').style('width'), 10)
                      , width = width - margin.left - margin.right
                      , height = 500 // placeholder
                      , barHeight = 20
                      , spacing = 3
                      , percent = d3.format('%');
            
            var leftScale = d3.scaleLinear()
                .domain([0.0, 100.0])
                .range([height - margin.top, margin.bottom]);

            var rightScale = d3.scaleLinear()
                .domain([0.0, 100.0])
                .range([height - margin.top, margin.bottom]);
        
            // create the chart
            var svg = d3.select('#chart').append('svg')
                .style('width', (width + margin.left + margin.right) + 'px')
                .append('g')
                .attr('transform', 'translate(' + [margin.left, margin.top] + ')');
            
            d3.csv('data.csv', function(d) {
                data = d;

                var lines = svg.selectAll("line")
                    .data(data);

                lines.enter()
                    .append("line")
                    .attr('class', 'lineclass')
                    .attr("x1", margin.left)
                    .attr("x2", width - margin.right)
                    .attr("y1", function(d) {
                        return leftScale(parseFloat(d['search_interest']));
                    })
                    .attr("y2", function(d) {
                        return rightScale(parseFloat(d['raw_incidence_rate']));
                    })
                    .attr("stroke", "black")
                    .attr("stroke-width", 1);

                var rightLabels = svg.selectAll(".labels")
                    .data(data);

                rightLabels.enter()
                    .append("text")
                    .attr("class","labels")
                    .attr("x", width - margin.right + 3)
                    .attr("y", function(d) {
                        return rightScale(parseFloat(d['raw_incidence_rate'])) + 4;
                    })
                    .text(function (d) {
                        return d['Country'];
                    });

                var leftLabels = svg.selectAll(".left-labels")
                    .data(data);

                leftLabels.enter()
                    .append("text")
                    .attr("class","left-labels")
                    .attr("x", margin.left - 65)
                    .attr("y", function(d) {
                        return leftScale(parseFloat(d['search_interest'])) + 4;
                    })
                    .text(function (d) {
                        return d['country'];
                    })
                    .style("text-anchor","begin");
                
                /*
            // update width
            width = parseInt(d3.select('#chart').style('width'), 10);
            width = width - margin.left - margin.right;

            
            //------------For Slope graph---------------
            
            svg.selectAll('line.lineclass')
                .attr("x1", margin.left)
                .attr("x2", width - margin.right);
            
            /*
                // resize the chart
            x.range([0, width]);
            d3.select(chart.node().parentNode)
                .style('height', (y.rangeExtent()[1] + margin.top + margin.bottom) + 'px')
                .style('width', (width + margin.left + margin.right) + 'px');

            chart.selectAll('rect.background')
                .attr('width', width);

            chart.selectAll('rect.percent')
                .attr('width', function(d) { return x(d.percent); });

            // update median ticks
            var median = d3.median(chart.selectAll('.bar').data(), 
                function(d) { return d.percent; });

            chart.selectAll('line.median')
                .attr('x1', x(median))
                .attr('x2', x(median));


            // update axes
            chart.select('.x.axis.top').call(xAxis.orient('top'));
            chart.select('.x.axis.bottom').call(xAxis.orient('bottom'));
            */

        //})
        //}
            /*
        
         $(document).ready(function() {
                BindControls();
            });
            
            
        
        
       

            function BindControls() {
                /*
                var Countries = ['ARGENTINA', 
                    'AUSTRALIA', 
                    'BRAZIL', 
                    'BELARUS', 
                    'BHUTAN',
                    'CHILE', 
                    'CAMBODIA', 
                    'CANADA', 
                    'CHILE', 
                    'DENMARK', 
                    'DOMINICA'];
                   
                
                console.log(optionsData);
                
                //var Countries = optionsData;
                    

                $('#tbCountries').autocomplete({
                    source: Countries,
                    minLength: 0,
                    scroll: true
                }).focus(function() {
                    $(this).autocomplete("search", "");
                });
                
            }
            */
        </script>
        
        
    </body>
</html>