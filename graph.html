<!DOCTYPE html>
<html>
   <head>
       <link rel="stylesheet" type="text/css" href="style.css">
       <meta name="viewport" content="width=device-width, initial-scale=1">
       <script src="https://d3js.org/d3.v4.min.js"></script>
       
       
        <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.11/jquery-ui.min.js"></script>
        
        <script src="d3.slider.js"></script>
        
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
        
        
        
        

   </head>
    <body>
        <div id="intro" class="container">
            <img src="zika.png" alt="ZIKA" id="zikaHeader">
            
        </div>
        <div id="intro2" class="container">
           <!--
            <p id="textintrodesktop">How does Google search interest in Zika relate to actual outbreak levels? Use this visualization to explore Zika search interest and Zika infection rates on a country-by-country level.
            </p> 
            -->
        </div>
        <div class="btn-group" id="buttonBar">
              <button id="firstbutton" type="button" class="btn btn-primary" value="8/18">8/18</button>
              <button type="button" class="btn btn-primary" value="8/25">8/25</button>
              <button type="button" class="btn btn-primary" value="9/1">9/1</button>
              <button type="button" class="btn btn-primary" value="9/8">9/8</button>                   <button type="button" class="btn btn-primary" value="9/15">9/15</button>    
              <button type="button" class="btn btn-primary" value="9/22">9/22</button>
              <button id="lastbutton" type="button" class="btn btn-primary active" value="9/29">9/29</button>
          </div>
          
          <!--
        <div id="selectors1">
          
           <p id="sliderlabels" style="text-align:left;">8/18<span style="text-align:right;float: right;">9/15</span></p>
            <div id="slider" > </div>
            <!--<input type="range" name="slider-1" id="slider-1" min="1" max="90" value="1" >
        </div>
        
        -->
        
        <div id="selectors2">
            <p id="droplabels">Enter country or region</p>
            <!--<input type="text" id="tbCountries" />
            <div id="tbCountries"></div> -->
            <input type="search" id="tags">
            <!--onchange="updateInput(this.value)"-->
        </div>
        <br>
        
        <div id="chart" class="container"></div>
        <div id="helpbox">
            <p>Hover over a line or select a region above. <br>For each region, you can see Google search interest in Zika<br> and actual Zika infection rate.
            </p>
        </div>
            
        <div id="footer">
            <p id="designed">
            <a href="http://www.paho.org/hq/index.php?option=com_content&view=article&id=12390&Itemid=42090&lang=en" target="_blank">Source: PAHO/WHO <br>Pan American Health Organization <br> World Health Organization</a><br><br>
            Designed by 
            <a href="http://www.sevika.co/" target="_blank">Sevika Singh</a> and 
            <a href="http://www.albertocairo.com/" target="_blank">Alberto Cairo</a>
            <br>Powered by: </p>
            <a href="http://www.google.com/trends/" target="_blank">
                <img src="trendslogoWhite.png" alt="Google Trends" id="trendsLogo">
            </a>
        </div>
        
        <script type="text/javascript">
            
            var optionsData;
            var dropDown;
            var dateSelected = "9/29";
            var countrySelected;
            var selected;
            var countryOn = false;
            
            var tooltipHeight;
            var tooltipWidth;
            
            if (($(window).width() < 1025)&&($(window).width() > 449)) {
                tooltipHeight = 250;
                tooltipWidth = 0;
            } else if ($(window).width() < 450) {
                tooltipHeight = 115;
                tooltipWidth = 20;
            }
            
            //var valMap = ["8/15", "8/28"];
            
            
            //$( "#slider" ).on( "slidechange", function( event, ui ) {} );
            
            var color2 = d3.scaleOrdinal(d3.schemeCategory20);
            
            var color = d3.scaleThreshold()
                .domain([true, false])
                .range(["#FBBC05", "#4285F4"]);
            
            var margin = {top: 15, right: 68, bottom: 30, left: 68}
                      , width = parseInt(d3.select('#chart').style('width'), 10)
                      , width = width - margin.left - margin.right
                      , height = width*1.25 // placeholder
                      , barHeight = 20
                      , spacing = 3
                      , percent = d3.format('%');
            
            var leftScale = d3.scaleLinear()
                .domain([0.0, 100.0])
                .range([height - margin.top, margin.bottom]);

            var rightScale = d3.scaleLinear()
                .domain([0.0, 100.0])
                .range([height - margin.top, margin.bottom]);
            
            
            // create the chart
            var svg = d3.select('#chart').append('svg')
                .style('width', (width + margin.left + margin.right) + 'px')
                .style('height', (height + margin.top + margin.bottom) + 'px')
                .attr('class', 'chartclass')
                .append('g')
                .attr('transform', 'translate(' + [margin.left, margin.top] + ')');
            
            var togglePosition = false;
            
            var div = d3.select("#chart").append("div")	
                .attr("class", "tooltip")				
                .style("opacity", 0);
            
            var div2 = d3.select("#chart").append("div")	
                .attr("class", "tooltip")				
                .style("opacity", 0);
            
            d3.csv('data.csv', function setGraph(d) {
                data = d;
                
                
                var data_max = d3.extent(data, function(d) {return d['raw_incidence_rate']; });
                
                var leftScale = d3.scaleLinear()
                    .domain([0.0, 100.0])
                    .range([height - margin.top, margin.bottom]);

                var rightScale = d3.scaleLinear()
                    .domain([0.0, 10000])
                    .range([height - margin.top, margin.bottom]);
                
                //data.sort(function (a, b) {
				//	return b.search_interest-a.search_interest;
				//});

                var lines = svg.selectAll("line")
                    .data(data);

                lines.enter()
                    .append("line")
                    .attr('class', 'lineclass')
                    .attr("x1", margin.left)
                    .attr("x2", width - margin.right)
                    .attr("y1", function(d) {
                        return leftScale(parseFloat(d['search_interest']));
                    })
                    .attr("y2", function(d) {return rightScale(parseFloat(d['raw_incidence_rate']));} )
                    //.attr("y1", height- margin.top, margin.bottom)
                    //.attr("y2", height- margin.top, margin.bottom)
                /*
                    .attr("y1", function(d) {
                        return leftScale(parseFloat(d['search_interest']));
                    })
                    .attr("y2", function(d) {
                        //console.log(d.search_interest-d.raw_incidence_rate < 0 );
                        return rightScale(parseFloat(d['raw_incidence_rate']));
                    })
                */
                    .attr("stroke", function(d) {
                    //.attr("class", function(d){return d.search_interest-d.raw_incidence_rate < 0 ? "negative" : "positive";})
                        return color(d.search_interest-(d.raw_incidence_rate/100) < 0);
                        //return color2(d.Date);
                    })
                    .attr("stroke-width", 1.5);
                
                /*
                svg.selectAll("line")
                    .on("mouseover", function(d) {		
                        div.transition()		
                            .duration(200)		
                            .style("opacity", 1);		
                        div.html(d.Country + "<br/>"  + d.search_interest)	
                            //.style("left", (d3.event.pageX) + "px")		
                            //.style("top", (d3.event.pageY - 28) + "px");
                            .attr("x", 0)
                            .attr("y", leftScale(parseFloat(d['search_interest']))-100);
                        })					
                    .on("mouseout", function(d) {		
                        div.transition()		
                            .duration(500)		
                            .style("opacity", 0);	
                    });
                */
                
                svg.selectAll("line").filter(function(d) {
                    //console.log("8/18" != d.Date, d.Country);
                                return "9/29" != d.Date;})
                                    .classed('displaylabels',true)
                                    .classed('showdisplaylabels',false);
                svg.selectAll("line").filter(function(d) {
                                return "9/29" == d.Date;})
                                    .classed('displaylabels',false)
                                    .classed('showdisplaylabels',true);
                /*
                svg.selectAll("line").transition()
                              //.delay(function(d, i) { return i * 5; })
                              //.duration(750)
                              .attr("y1", function(d) {return leftScale(parseFloat(d['search_interest']));})
                              .attr("y2", function(d) {return rightScale(parseFloat(d['raw_incidence_rate']));} );
                
                */
                var rightLabels = svg.selectAll(".labels")
                    .data(data);
                
                var leftLabels = svg.selectAll(".labels")
                    .data(data);
                
               
                
                //YELLOW LABELS
             

                rightLabels.enter()
                    .append("text")
                    .attr("class","labelsclass labels1 displaylabels wrapthis")
                    .attr("x", 38)
                    .attr("y", function(d) {
                        return leftScale(parseFloat(d['search_interest'])) + 4;
                    })
                .attr("dy", ".1em")
                    .attr("text-anchor", "end")
                    //.append("tspan")
                    .text(function (d) {return (d['Country']);})
                    
                        .style("fill",function(d) {
                        return color(d.search_interest-(d.raw_incidence_rate/100) < 0);
                    });
                    //.text(function (d) {
                      //  return (d['Country']);
                    //});
                
                rightLabels.enter()
                    .append("text")
                    .attr("class","labelsclass labels2 displaylabels")
                    .attr("x", 38)
                    .attr("y", function(d) {
                        return leftScale(parseFloat(d['search_interest'])) + 15;
                    })
                    .attr("text-anchor", "end")
                    .append("tspan").text("Search Rank: ")
                        .style("fill",function(d) {
                        return color(d.search_interest-(d.raw_incidence_rate/100) < 0);
                    })
                    .append("tspan").text(function (d) {return ordinal_suffix_of(d['search_rank']);})
                        .style("fill","white");
                
                
                function ordinal_suffix_of(i) {
                        var j = i % 10,
                            k = i % 100;
                        if (j == 1 && k != 11) {
                            return i + "st";
                        }
                        if (j == 2 && k != 12) {
                            return i + "nd";
                        }
                        if (j == 3 && k != 13) {
                            return i + "rd";
                        }
                        return i + "th";
                    }
                
                
                
                
                
                    //.text(function (d) {
                      //  return ("Interest " + d['search_interest']);
                    //});
                rightLabels.enter()
                    .append("text")
                    .attr("class","labelsclass labels3 displaylabels")
                    .attr("x", 38)
                    .attr("y", function(d) {
                        return leftScale(parseFloat(d['search_interest'])) + 26;
                    })
                    .attr("text-anchor", "end")
                    .append("tspan").text("Zika Rate: ")
                        .style("fill",function(d) {
                        return color(d.search_interest-(d.raw_incidence_rate/100) < 0);
                    })
                    .append("tspan").text(function (d) {return (d['raw_incidence_rate']);})
                        .style("fill","white");
                    //.text(function (d) {
                      //  return ("Rate " + d['raw_incidence_rate']);
                   // });
                   
                
                //BLUE LABELS

                leftLabels.enter()
                    .append("text")
                    //.attr("class","labelsclass labels1 displaylabels")
                    .attr("class","bluelabels animoff")
                .style("font-size","10px")
                    /*.attr("x", width-45)
                    .attr("y", function(d) {
                        return rightScale(parseFloat(d['raw_incidence_rate'])) + 0;
                    })
                    */
                    .attr("x", 38)
                    .attr("y", function(d) {
                        return leftScale(parseFloat(d['search_interest'])) + 5;
                    })
                    .attr("text-anchor", "end")
                    .append("tspan").text(function (d) {return (d['Country']);})
                        
                        .style("fill",function(d) {
                        return color(d.search_interest-(d.raw_incidence_rate/100) < 0);
                    });
                
                
                    //.text(function (d) {
                      //  return (d['Country']);
                    //});
                leftLabels.enter()
                    .append("text")
                    .attr("class","bluelabels animoff")
                .style("font-size","10px")
                /*
                    .attr("x", width-45)
                    .attr("y", function(d) {
                        return rightScale(parseFloat(d['raw_incidence_rate'])) + 12;
                    })
                    */
                    .attr("x", 38)
                    .attr("y", function(d) {
                        return leftScale(parseFloat(d['search_interest'])) + 16;
                    })
                    .attr("text-anchor", "end")
                    .append("tspan").text("Search Rank: ")
                        .style("fill",function(d) {
                        return color(d.search_interest-(d.raw_incidence_rate/100) < 0);
                    })
                    .append("tspan").text(function (d) {return (d['search_rank']);})
                        .style("fill","white");
                
                
                    //.text(function (d) {
                      //  return ("Interest " + d['search_interest']);
                    //});
                leftLabels.enter()
                    .append("text")
                    .attr("class","bluelabels animoff")
                .style("font-size","10px")
                    .attr("x", 38)
                    .attr("y", function(d) {
                        return leftScale(parseFloat(d['search_interest'])) + 27;
                    })
                    .attr("text-anchor", "end")
                    .append("tspan").text("Zika Rate: ")
                        .style("fill",function(d) {
                        return color(d.search_interest-(d.raw_incidence_rate/100) < 0);
                    })
                    .append("tspan").text(function (d) {return (d['raw_incidence_rate']);})
                        .style("fill","white");
                
                
               
                
                var y_domain2 = d3.extent(data, function(d) {return d['raw_incidence_rate']; });

                var yScale = d3.scaleLinear()
                    .domain([0,100])
                    .range([height -  margin.top, margin.bottom], 0);  
                
                var yScale2 = d3.scaleLinear()
                    .domain([data_max[0], 10000])
                //data_max[1]
                    .range([height -  margin.top, margin.bottom], 0); 
                
                var axisScale = d3.scaleLinear()
                         .domain([0,100])
                         .range([0,100]);

                var yAxisLeft = d3.axisLeft()
                    .ticks(2)
                    .scale(yScale);
                
                var yAxisRight = d3.axisRight()
                    .ticks(2)
                    .scale(yScale2);
                    
                
                svg.append("svg:g")
                    .attr("transform", "translate(" + (margin.left+5) +  ",0)")
                    .attr("class", "y axis whiteText")
                    .call(yAxisLeft);
                
                svg.append("svg:g")
                    .attr("transform", "translate(" + (width-margin.left-5) + " ,0)")	
                    .attr("class", "y axis whiteText")
                    .call(yAxisRight);
                
                svg.append("text")
                    .attr("class", "whiteText")
                    .style("font-size","0.9em")
                    .attr("text-anchor", "middle")
                    .attr("transform", "translate("+ (margin.left +6) +","+(12)+")")
                    .text("Zika Search");
                
                
                svg.append("text")
                    .attr("class", "whiteText")
                    .style("font-size","0.9em")
                    .attr("text-anchor", "middle")
                    .attr("transform", "translate("+ (margin.left -5) +","+(22)+")")
                    .text("Interest");
                    
                
                svg.append("text")
                    .attr("class", "whiteText")
                    .style("font-size","0.9em")
                    .attr("text-anchor", "middle")
                    .attr("transform", "translate("+ (width -margin.left +5) +","+(12)+")")
                    .text("Zika Cases Per");
                
                svg.append("text")
                    .attr("class", "whiteText")
                    .style("font-size","0.9em")
                    .attr("text-anchor", "middle")
                    .attr("transform", "translate("+ (width -margin.left +3) +","+(22)+")")
                    .text("100,000 People");
                
                
                console.log(y_domain2);
                
                optionsData = (data.map(function(d) {return d.Country;}));
                optionsData.sort();
                
                Array.prototype.unique = function(a){
                        return function(){ return this.filter(a) }
                    }(function(a,b,c){ return c.indexOf(a,b+1) < 0 });
                
                
                optionsData = optionsData.unique();
                
                data2 = data.sort(function (a, b) {
					return d3.ascending(a.Country, b.Country);
				});
                
                //console.log(data2);
                
                dropDown = d3.select("#tbCountries").append("select")
                    .attr("name", "country-list");
                
                var options = dropDown.selectAll("option")
                           .data(optionsData)
                         .enter()
                           .append("option")
                            .attr("value", function(d) {return d})
                            .text(function(d) {return d;});

                //options.text(function (d) { return d.Country; })
                       //.attr("value", function (d) { return d.Country; });
                
                d3.selection.prototype.moveToFront = function() {
                  return this.each(function(){
                    this.parentNode.appendChild(this);
                  });
                };
                
                
                
                
                
                /*
                
                //OLD DROP DOWN SELECTION
                dropDown.on("change", function() {
                      selected = this.value;
                      countrySelected = selected;
                      displayOthers = this.checked ? "inline" : "none";
                      display = this.checked ? "none" : "inline";

                    

                     // doubleChart.selectAll(".circle")
                    svg.selectAll("line").filter(function(d) {
                        //console.log(d.Country);
                        return  ((selected != d.Country)&&(d.Date==dateSelected));})
                          //.attr("display", displayOthers);
                          //.attr("fill", "#884dff")
                            //.style("stroke", "#884dff")
                            //.attr("stroke", "green")
                            .style("stroke-width", 1.5)
                            .style("opacity", .5 );

                      //doubleChart.selectAll(".circle")
                    svg.selectAll("line").filter(function(d) {
                        return ((selected == d.Country)&&(d.Date==dateSelected));})
                          //.attr("display", display);
                            //.attr("fill", "white")
                            //.style("stroke", "red")
                            //.attr("stroke", "red")
                            .moveToFront()
                            .style("opacity", 1)
                            .style("stroke-width", 6); 
                    
                    svg.selectAll("rightLabels").filter(function(d) {
                        console.log("not", d.Country, d.Date);
                        return ((selected != d.Country)&&(d.Date==dateSelected));})
                            //.attr("class", "displaylabels");
                                    .classed('showdisplaylabels',false)
                                    .classed('displaylabels',true)
                                    .attr("display", "none");
                    
                    svg.selectAll("rightLabels").filter(function(d) {
                        console.log(d.Country, d.Date);
                        return ((selected == d.Country)&&(d.Date==dateSelected));})
                            //.attr("class", "showdisplaylabels")
                                    
                                    .classed('showdisplaylabels',true)
                                    .classed('displaylabels',false)
                                    .attr("display", "inline");
                    //.attr("fill", "green");
                    
                    //console.log("changed");
                    
                    
                  });
                
                
                */
                
                svg.selectAll("line")
                    .on("click", function(d){
                    svg.selectAll(".labelsclass")
                            .classed('animoff',true)
                            .classed('animon',false);
                    
                        svg.selectAll(".bluelabels")
                            .classed('animoff',true)
                            .classed('animon',false);
                    
                    if (d.search_interest-(d.raw_incidence_rate/100) < 0) {
                        svg.selectAll(".bluelabels")
                            .classed('animoff',true)
                            .classed('animon',false);
                          
                        svg.selectAll(".bluelabels").filter(function(d) {
                            return ((countrySelected == d.Country)&&(d.Date==dateSelected));})
                            .classed('animoff',false)
                            .classed('animon',true);
                
                        
                    } else if (d.search_interest-(d.raw_incidence_rate/100) > 0) {
                        svg.selectAll(".labelsclass")
                            .classed('animoff',true)
                            .classed('animon',false);
                
                        svg.selectAll(".labelsclass").filter(function(d) {
                            //console.log("printed");
                            return ((countrySelected == d.Country)&&(d.Date==dateSelected));})
                            .classed('animoff',false)
                            .classed('animon',true);  
                    }
                    
                    /*
                        div.transition()		
                            .duration(200)		
                            .style("opacity", 1);		
                        div.html(d.Country+"<br/>Search Rank: <span>"+ ordinal_suffix_of(d.search_rank) + "</span><br/> Zika Rate: <span>" + d.raw_incidence_rate+"</span>")
                        .style("color", color(d.search_interest-(d.raw_incidence_rate/100) < 0))
                            .style("left", tooltipWidth + "px")		
                            .style("top", (leftScale(parseFloat(d['search_interest']))+tooltipHeight) + "px");
                    */
                            //.style("left", (d3.event.pageX) + "px")		
                            //.style("top", (d3.event.pageY - 28) + "px");
                            //.attr("x", 0)
                            //.attr("y", 100);
                                //leftScale(parseFloat(d['search_interest']))-100
                    
                        svg.selectAll("line")
                            .style("stroke-width", 1.5)
                            .style("opacity", 0.4 );
                        d3.select(this)
                            .moveToFront()
                            .style("opacity", 1)
                            .style("stroke-width", 6);
                        var countrySend;
                    d3.select(this).each(function(d){
                        //countrySelected = d.Country;
                        countrySend=(d.Country)
                    });
                    d3.select(this).each(function(d){
                        countrySelected = d.Country
                        //countrySend=(d.Country);
                    });
                    countryOn = true;
                        //console.log(countrySend);
                        //d3.select(this).each(function(d){console.log(d.Country)});
                        //selectaline(countrySend);
                    });
                
                
                svg.selectAll("line")
                    .on("mouseover", function(d){
                    
                    svg.selectAll(".bluelabels")
                                        .classed('animoff',true)
                                        .classed('animon',false);
                    
                    svg.selectAll(".labelsclass")
                            .classed('animoff',true)
                            .classed('animon',false);
                    
                    if (d.search_interest-(d.raw_incidence_rate/100) < 0) {
                        svg.selectAll(".bluelabels")
                            .classed('animoff',true)
                            .classed('animon',false);
                          
                        svg.selectAll(".bluelabels").filter(function(d) {
                            return ((countrySelected == d.Country)&&(d.Date==dateSelected));})
                            .classed('animoff',false)
                            .classed('animon',true);
                
                        
                    } else if (d.search_interest-(d.raw_incidence_rate/100) > 0) {
                        svg.selectAll(".labelsclass")
                            .classed('animoff',true)
                            .classed('animon',false);
                
                        svg.selectAll(".labelsclass").filter(function(d) {
                            //console.log("printed");
                            return ((countrySelected == d.Country)&&(d.Date==dateSelected));})
                            .classed('animoff',false)
                            .classed('animon',true);  
                    }
                    
                    /*
                        div.transition()		
                                .duration(200)		
                                .style("opacity", 1);		
                        div.html(d.Country+"<br/>Search Rank: <span>"+ ordinal_suffix_of(d.search_rank) + "</span><br/> Zika Rate: <span>" + d.raw_incidence_rate+"</span>")
                        .style("color", color(d.search_interest-(d.raw_incidence_rate/100) < 0))
                                .style("left", tooltipWidth + "px")		
                                .style("top", (leftScale(parseFloat(d['search_interest']))+tooltipHeight) + "px");
                       */
                            //.style("left", (d3.event.pageX) + "px")		
                            //.style("top", (d3.event.pageY - 28) + "px");
                            //.attr("x", 0)
                            //.attr("y", 100);
                                //leftScale(parseFloat(d['search_interest']))-100
                    
                        svg.selectAll("line")
                            .style("stroke-width", 1.5)
                            .style("opacity", 0.4 );
                        d3.select(this)
                            .moveToFront()
                            .style("opacity", 1)
                            .style("stroke-width", 6);
                        var countrySend;
                    d3.select(this).each(function(d){countrySend=(d.Country)});
                    d3.select(this).each(function(d){countrySelected=(d.Country)});
                        //console.log(countrySend);
                        //d3.select(this).each(function(d){console.log(d.Country)});
                        //selectaline(countrySend);
                    
                countryOn = true;
                    });
              
                
                
              
                function selectaline (countrySend) {
                    countrySelected = countrySend;
                    countryOn = true;
                    svg.selectAll(".labelsclass")
                            .style("opacity", 1)
                            .classed('animoff',true)
                            .classed('animon',false);
                    
                    svg.selectAll(".labelsclass").filter(function(d) {
                            return ((countrySelected == d.Country)&&(d.Date==dateSelected));})
                            .classed('animoff',false)
                            .classed('animon',true);
                            
                    svg.selectAll(".labelsclass").filter(function(d) {
                            return ((countrySelected == d.Country)&&(d.Date!=dateSelected));})
                            .classed('animoff',true)
                            .classed('animon',false);
                }
                
                
                var steps = [
                    "8/18",
                    "8/25",
                    "9/1",
                    "9/8",
                    "9/15",
                    "9/22",
                    "9/29"
                ];
                
                var ticks  = 
                    '<div class="sliderTickmarks "><span></span></div>';
                    ticks += '<div class="sliderTickmarks "><span></span></div>';
                    ticks += '<div class="sliderTickmarks "><span></span></div>';
                    ticks += '<div class="sliderTickmarks "><span></span></div>';
                    ticks += '<div class="sliderTickmarks "><span></span></div>';
                    ticks += '<div class="sliderTickmarks "><span></span></div>';
                    ticks += '<div class="sliderTickmarks "><span></span></div>';
                    
                    $("#slider").prepend(ticks);

                $(function() {
                    $("#slider").slider({
                        value: 6,
                        min: 0,
                        max: 6,
                        step: 1,
                        create: function( event, ui ) {
                          setSliderTicks(event.target);
                        },
                        slide: function(event, ui) {
                            $("#amount").val(steps[ui.value]);
                            dateSelected= steps[ui.value];
                            console.log(dateSelected);
                            
                            
                            var selected2 = dateSelected;
                            
                            svg.selectAll(".bluelabels")
                                .classed('animoff',true)
                                .classed('animon',false);
                            
                            
                            svg.selectAll("line").filter(function(d) {
                                //console.log(d.Date, d.Country);
                                return selected2 != d.Date;})
                                    //.transition()
                                    //.style("stroke", "red");
                                    .classed('showdisplaylabels',false)
                                    .classed('displaylabels',true)
                                    .attr("display", "none");
                            svg.selectAll("line").filter(function(d) {
                                return selected2 == d.Date;})
                                    //.transition()
                                    //.style("stroke", "green");
                                .classed('showdisplaylabels',true)
                                .classed('displaylabels',false)
                                    .attr("display", "inline");
                            
                            svg.selectAll("line")
                               // .attr("y1", height/2)
                               // .attr("y2", height/2)
                            .attr("y1", function(d) {return leftScale(parseFloat(d['search_interest']));})
                              .attr("y2", function(d) {return rightScale(parseFloat(d['raw_incidence_rate']));} );
                            /*
                            
                            svg.selectAll("line").transition()
                             // .delay(function(d, i) { return i * 5; })
                              //.duration(350);
                              .attr("y1", function(d) {return leftScale(parseFloat(d['search_interest']));})
                              .attr("y2", function(d) {return rightScale(parseFloat(d['raw_incidence_rate']));} );
                            */
                            
                            
                            
                            svg.selectAll("line").filter(function(d) {
                                //console.log(d.Country);
                                return  ((countrySelected != d.Country)&&(d.Date==dateSelected));})
                                  //.attr("display", displayOthers);
                                  //.attr("fill", "#884dff")
                                    //.style("stroke", "#884dff")
                                    //.attr("stroke", "green")
                                    .style("stroke-width", 1.5)
                                    .style("opacity", 0.4 );

                              //doubleChart.selectAll(".circle")
                            svg.selectAll("line").filter(function(d) {
                                return ((countrySelected == d.Country)&&(d.Date==dateSelected));})
                                  //.attr("display", display);
                                    //.attr("fill", "white")
                                    //.style("stroke", "red")
                                    //.attr("stroke", "red")
                                    .moveToFront()
                                    .style("opacity", 1)
                                    .style("stroke-width", 6); 
                            
                            /*
                          svg.selectAll(".labelsclass").filter(function(d) {
                            return ((countrySelected != d.Country)&&(d.Date!=dateSelected));})
                            .classed('animoff',true)
                            .classed('animon',false);
                          
                          svg.selectAll(".labelsclass").filter(function(d) {
                            return ((countrySelected == d.Country)&&(d.Date==dateSelected));})
                            .classed('animoff',false)
                            .classed('animon',true);
                            
                          svg.selectAll(".labelsclass").filter(function(d) {
                            return ((countrySelected == d.Country)&&(d.Date!=dateSelected));})
                            .classed('animoff',true)
                            .classed('animon',false);
                       
                            */
                            
                            
                            if(countryOn == false) {
                                svg.selectAll("line").filter(function(d) {
                                    if (d.search_interest > 99 && dateSelected== d.Date) {
                                        d3.select(this).each(function(d){
                                            countrySelected = d.Country
                                            //countrySend=(d.Country);
                                            //console.log(countrySelected, "poop", d.Date);
                                            printLabels();
                                        });
                                    }
                                        //return ((d.search_interest > 99));
                                        
                                
                                    div.transition()		
                                        .duration(0)		
                                        .style("opacity", 1);		
                                    div.html(d.Country+"<br/>Search Rank: <span>"+ ordinal_suffix_of(d.search_rank) + "</span><br/> Zika Rate: <span>" + d.raw_incidence_rate+"</span>")
                        .style("color", color(d.search_interest-(d.raw_incidence_rate/100) < 0))
                                        .style("left", tooltipWidth + "px")		
                                        .style("top", (leftScale(parseFloat(d['search_interest']))+tooltipHeight) + "px");
                                })
                                            .moveToFront()
                                            .style("opacity", 1)
                                            .style("stroke-width", 6); 
                                
                                return ((d.search_interest > 99 && dateSelected== d.Date));
                                //console.log(countrySelected);
                                //printLabels();

                                /*
                                svg.selectAll(".labelsclass")
                                            .classed('animoff',true)
                                            .classed('animon',false);

                            
                                svg.selectAll(".labelsclass").filter(function(d) {
                                           // console.log(d.search_interest, d.Country);
                                            return ((d.search_interest > 99))&&(d.Date==dateSelected);})
                                            .classed('animoff',false)
                                            .classed('animon',true);
                                            */
                            }
                            
                            printLabels();
                            
                        }
                    });
                    $("#amount").val(steps[$("#slider").slider("value")]);
                });
                
                
            $('#buttonBar button').click(function() {
                $(this).addClass('active').siblings().removeClass('active');
                dateSelected = this.value;
                

                var selected2 = dateSelected;
                
                svg.selectAll(".labelsclass")
                    .classed('animoff',true)
                    .classed('animon',false);

                svg.selectAll(".bluelabels")
                    .classed('animoff',true)
                    .classed('animon',false);


                svg.selectAll("line").filter(function(d) {
                    //console.log(d.Date, d.Country);
                    return selected2 != d.Date;})
                        //.transition()
                        //.style("stroke", "red");
                        .classed('showdisplaylabels',false)
                        .classed('displaylabels',true)
                        .attr("display", "none");
                svg.selectAll("line").filter(function(d) {
                    return selected2 == d.Date;})
                        //.transition()
                        //.style("stroke", "green");
                    .classed('showdisplaylabels',true)
                    .classed('displaylabels',false)
                        .attr("display", "inline");

                svg.selectAll("line")
                   // .attr("y1", height/2)
                   // .attr("y2", height/2)
                .attr("y1", function(d) {
                    /*
                    console.log(
                        d.Country, 
                        leftScale(parseFloat(d['search_interest']))
                    );*/
                    return leftScale(parseFloat(d['search_interest']));
                })
                  .attr("y2", function(d) {return rightScale(parseFloat(d['raw_incidence_rate']));} );
                

                if(countryOn==true) {
                    svg.selectAll("line").filter(function(d) {
                        //console.log(d.Country);
                        return  ((countrySelected != d.Country)&&(d.Date==dateSelected));})
                          //.attr("display", displayOthers);
                          //.attr("fill", "#884dff")
                            //.style("stroke", "#884dff")
                            //.attr("stroke", "green")
                            .style("stroke-width", 1.5)
                            .style("opacity", 0.4 );

                      //doubleChart.selectAll(".circle")
                    svg.selectAll("line").filter(function(d) {
                        return ((countrySelected == d.Country)&&(d.Date==dateSelected));})
                          //.attr("display", display);
                            //.attr("fill", "white")
                            //.style("stroke", "red")
                            //.attr("stroke", "red")
                            .moveToFront()
                            .style("opacity", 1)
                            .style("stroke-width", 6); 
                    
                     printLabels();
                }


                if(countryOn == false) {
                   svg.selectAll("line").filter(function(d) {
                                                return (d.search_rank==1)&& d.Date==dateSelected||(d.search_rank==5)&& d.Date==dateSelected||(d.Country== "Martinique")&&(d.Date==dateSelected);})
                    
                                .moveToFront()
                                .style("opacity", 1)
                                .style("stroke-width", 6); 

                   svg.selectAll(".labelsclass")
                            .classed('animoff',true)
                            .classed('animon',false);
                
                    svg.selectAll(".labelsclass").filter(function(d) {
                            return ((d.search_rank==1)&& d.Date==dateSelected||(d.search_rank==5)&& d.Date==dateSelected);})
                            .classed('animoff',false)
                            .classed('animon',true);
                    
                    
                          svg.selectAll(".bluelabels")
                            .classed('animoff',true)
                            .classed('animon',false);
                          
                          svg.selectAll(".bluelabels").filter(function(d) {
                            return (d.Country== "Martinique")&&(d.Date==dateSelected);})
                            .classed('animoff',false)
                            .classed('animon',true);
                }
                
                

               

            });
            
                
                
                function setSliderTicks(el) {
                    var $slider =  $(el);
                    var max =  $slider.slider("option", "max");    
                    var min =  $slider.slider("option", "min");    
                    var spacing =  100 / (max - min);

                    $slider.find('.ui-slider-tick-mark').remove();
                    for (var i = 0; i < max-min ; i++) {
                        $('<span class="ui-slider-tick-mark"></span>').css('left', (spacing * i) +  '%').appendTo($slider); 
                     }
                }
                
                function printLabels () {
                    
                    svg.selectAll("line").filter(function(d) {
                        /*
                            div.transition()		
                                .duration(200)		
                                .style("opacity", 1);		
                           div.html(d.Country+"<br/>Search Rank: <span>"+ ordinal_suffix_of(d.search_rank) + "</span><br/> Zika Rate: <span>" + d.raw_incidence_rate+"</span>")
                        .style("color", color(d.search_interest-(d.raw_incidence_rate/100) < 0))
                                .style("left", tooltipWidth + "px")		
                                .style("top", (leftScale(parseFloat(d['search_interest']))+tooltipHeight) + "px");
                       
                          */
                       // console.log((countrySelected == d.Country)&&(d.Date==dateSelected));
                        
                        return ((countrySelected == d.Country)&&(d.Date==dateSelected));
                      })
                    
                        svg.selectAll(".labelsclass")
                            .classed('animoff',true)
                            .classed('animon',false);
                    
                        svg.selectAll(".bluelabels")
                            .classed('animoff',true)
                            .classed('animon',false);
                          
                        svg.selectAll(".bluelabels").filter(function(d) {
                            return ((countrySelected == d.Country)&&(d.Date==dateSelected));})
                            .classed('animoff',false)
                            .classed('animon',true);
                    
                            
                }
                
                //REAL DROP DOWN SELECTION
                $( function() {
                    var availableTags = optionsData;
                    $( "#tags" ).autocomplete({
                      source: availableTags,
                        minLength: 0,
                        scroll: true,
                      select: function(event, ui) {
  
                    svg.selectAll(".labelsclass")
                            .classed('animoff',true)
                            .classed('animon',false);
                          
                          svg.selectAll(".bluelabels")
                            .classed('animoff',true)
                            .classed('animon',false);
                
                          //alert(ui.item.value);
                          selected3 = ui.item.value;
                          countrySelected = selected3;
                          countryOn = true;
                          
                          svg.selectAll(".bluelabels")
                            .classed('animoff',true)
                            .classed('animon',false);
                          
                          svg.selectAll("line").filter(function(d) {
                            return ((selected3 != d.Country)&&(d.Date==dateSelected));
                          })
                            .style("stroke-width", 1.5)
                            .style("opacity", 0.4 );
                        
                          
                          svg.selectAll("line").filter(function(d) {
                            
                           // console.log(d.Country);
                            
                              
                            
                            return ((selected3 == d.Country)&&(d.Date==dateSelected));
                          })
                            .moveToFront()
                            .style("opacity", 1)
                            .style("stroke-width", 6); 
                          
                          printLabels();
                         // d3.select(this).each(function(d){console.log(d.Country);});
                          
                          
                          
                          /*
                          div.transition()		
                                .duration(200)		
                                .style("opacity", 1);		
                          div.html("<span>"+d.Country+"</span>" + "<span><br/> Interest </span>" + d.search_interest + "<span><br/> Rate </span>" + d.raw_incidence_rate)	
                                .style("left", 20 + "px")		
                                .style("top", (leftScale(parseFloat(d['search_interest']))+100) + "px");
                          
                          
                          
                          svg.selectAll(".labelsclass")
                              //.filter(function(d) {
                            //return ((selected3 != d.Country)&&(d.Date!=dateSelected));})
                            .classed('animoff',true)
                            .classed('animon',false);
                          
                          svg.selectAll(".labelsclass").filter(function(d) {
                            return ((selected3 == d.Country)&&(d.Date==dateSelected));})
                            .classed('animoff',false)
                            .classed('animon',true);
                            */
                            
                          
                        document.activeElement.blur();
                          
                      }
                    }).focus(function() {
                        $(this).autocomplete("search", "");
                    });
                    
                  } );
                
            svg.selectAll("line").filter(function(d) {
                        return (d.search_interest > 99);
            
            })
                            .moveToFront()
                            .style("opacity", 1)
                            .style("stroke-width", 6); 
                /*
            svg.selectAll(".labelsclass")
                            .classed('animoff',true)
                            .classed('animon',false);
                
            svg.selectAll(".labelsclass").filter(function(d) {
                            return ((d.search_interest > 99))&&(d.Date=="8/25");})
                            .classed('animoff',false)
                            .classed('animon',true);
                */
                
                
            //printLabels();
                
                          
                
                          svg.selectAll(".bluelabels")
                              //.filter(function(d) {
                            //return ((selected3 != d.Country)&&(d.Date!=dateSelected));})
                            .classed('animoff',true)
                            .classed('animon',false);
                          
                          svg.selectAll(".bluelabels").filter(function(d) {
                            return (("Martinique" == d.Country)&&(d.Date==dateSelected));})
                            .classed('animoff',false)
                            .classed('animon',true);
                
                
                
                   
                      svg.selectAll("line").filter(function(d) {
                        return (
                        (d.search_rank==1)&& d.Date==dateSelected||(d.search_rank==5)&& d.Date==dateSelected
                        /*
                        (d.search_interest!=40&&d.search_interest!=68&&((d.search_interest%7.5 == 0))&&(d.search_interest >34)||(d.search_interest ==100)&&(d.Date==dateSelected)*/
                                ||(d.Country== "Martinique")&&(d.Date==dateSelected));
            
            })
                            .moveToFront()
                            .style("opacity", 1)
                            .style("stroke-width", 6); 
                     
                    svg.selectAll(".labelsclass")
                            .classed('animoff',true)
                            .classed('animon',false);
                
                    svg.selectAll(".labelsclass").filter(function(d) {
                            return ((d.search_rank==1)&& d.Date==dateSelected||(d.search_rank==5)&& d.Date==dateSelected);})
                            .classed('animoff',false)
                            .classed('animon',true);
                
                        svg.selectAll(".bluelabels")
                            .classed('animoff',true)
                            .classed('animon',false);
                          
                          svg.selectAll(".bluelabels").filter(function(d) {
                            return (d.Country== "Martinique")&&(d.Date==dateSelected)
                            ;})
                            .classed('animoff',false)
                            .classed('animon',true);
                
                
            }); 
            
            
            
            
            
            var is_keyboard = false;
            var initial_screen_size = window.innerHeight;
            
            function getTemplate() {
                
                is_keyboard = (window.innerHeight <= initial_screen_size);
            
                if ($(window).width() >= 1025) {
                   // return 
                    window.location.replace("graph_desktop.html");
                    //alert($(window).width(), "desktop enabled");
                }

                 else if (($(window).width() < 1025)&&(is_keyboard == false)&& isMobile==false) {
                    //return
                    window.location.replace("graph.html");
                    //alert($(window).width(), "mobile enabled");
                }
                
                else if ($(window).width() < 1025 && isMobile==false) {
                    //return
                    window.location.replace("graph.html");
                    //alert($(window).width(), "mobile enabled");
                }
                
                
                
            
            }
            window.addEventListener("resize", getTemplate);

            //getTemplate();
            
            var isMobile = false; //initiate as false
// device detection
if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent) 
    || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))) isMobile = true;
          
            
            
        </script>
        
        
    </body>
</html>